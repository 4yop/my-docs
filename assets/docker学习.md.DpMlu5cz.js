import{_ as a,c as i,o as n,ae as e}from"./chunks/framework.CmsL9_ih.js";const c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"docker学习.md","filePath":"docker学习.md"}'),p={name:"docker学习.md"};function t(l,s,k,h,r,o){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h2 id="镜像-容器-仓库" tabindex="-1">镜像，容器,仓库 <a class="header-anchor" href="#镜像-容器-仓库" aria-label="Permalink to &quot;镜像，容器,仓库&quot;">​</a></h2><p>镜像(image)相当于类， 容器(container)相当与对象，对象是类的实例化 仓库(repository)</p><h2 id="命令" tabindex="-1">命令 <a class="header-anchor" href="#命令" aria-label="Permalink to &quot;命令&quot;">​</a></h2><h3 id="帮助类" tabindex="-1">帮助类 <a class="header-anchor" href="#帮助类" aria-label="Permalink to &quot;帮助类&quot;">​</a></h3><p>systemctl start docker:启动<br> systemctl stop docker:停止<br> systemctl restart docker:重启<br> systemctl status docker:看状态<br> systemctl enable docker:开机自启 docker version:查看版本信息<br> docker info:概要信息 docker --help:帮助文档 docker [命令] --help:某个指令的帮助文档</p><h3 id="镜像命令" tabindex="-1">镜像命令 <a class="header-anchor" href="#镜像命令" aria-label="Permalink to &quot;镜像命令&quot;">​</a></h3><p>docker images: 列出镜像，-a(所有),-q(只显示镜像id)<br> docker search [关键字] [--limit 数量]:搜索仓库,限制结果数(选填)<br> docker pull [xx:tag]:拉去镜像到本地<br> docker system df:看镜像/容器占的空间<br> docker rmi -f [xxx:tag] [xxx:tag]:删除镜像<br> docker rmi -f $(docker images -q):镜像全删</p><h3 id="容器命令" tabindex="-1">容器命令 <a class="header-anchor" href="#容器命令" aria-label="Permalink to &quot;容器命令&quot;">​</a></h3><p>启动并在容器执行命令<br> docker run -it ubuntu /bin/bash<br> docker run -it -d -p 3307:3307 -p 3308:3308 --name=&quot;my-ubuntu&quot; ubuntu /bin/bash<br> --name:容器名字<br> -d:守护式容器<br> -i:交互模式运行<br> -t:分配一个伪输入终端<br> -P:随机映射端口<br> -p:指定映射端口<br> -v:目录映射,&lt;宿主机目录&gt;:&lt;容器目录&gt;:rw(可读可写),ro(只读)<br> --privileged=true:特权 --volumes-from 父类:父类是别的容器的name --network:网络模式</p><p>docker ps:查看正在运行的容器,(-a:已退的，-q:只显id) docker start [xx]:启动容器<br> docker restart [xx]:重启容器<br> docker stop [xx]:停止容器<br> docker kill [xx]:强制停止容器 docker rm [xx]:删除停止的容器，docker rm -f $(docker ps -a -q)</p><p>docker log [xx]:查看容器控制台输出<br> docker top [xx]:查看容器进程 docker inspect [xx]:查看容器内部细节</p><p>docker exec -it [xx]:重新进入容器shell,docker exec -it 2703eaa /bin/bash<br> docker attach [xx]:进入容器shell,退出容器会停止</p><p>docker cp [容器id:容器目录] [主机目录]:复制容器文件到主机</p><p>docker export [id] &gt; [文件名.tar]:导出容器内容tar文件归档<br> cat [文件名.tar] | docker import - [用户/镜像名:tag]:导入tar文件为镜像<br> docker commit -m=&quot;信息&quot; -a=&quot;作者&quot; [容器id] [镜像名:tag]:提交容器成为新镜像</p><p>docker login --u [用户名] -p [密码]</p><h3 id="用例" tabindex="-1">用例 <a class="header-anchor" href="#用例" aria-label="Permalink to &quot;用例&quot;">​</a></h3><p>docker run -d -p 3306:3306 --privileged=true -v xxx:/var/log/mysql -v xxx:/var/lib/mysql -v xxx:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123465 --name=&quot;mysql&quot; mysql:5.7</p><p>docker run -p 6379:6379 --privileged=true -v xxx/redis.conf:/etc/redis/redis.conf -v xxx/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf</p><h2 id="dockerfile" tabindex="-1">dockerfile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;dockerfile&quot;">​</a></h2><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;镜像:tag&gt;   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LABEL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;key&gt;=&lt;value&gt;//为镜像添加元数据   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;命令&gt;或[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;x&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;parame1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;parame2&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//镜像构建时执行的命令   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parame1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;parame2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//容器启动时执行的命令   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;executable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;param1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;param2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//配置容器启动时的入口命令，比如:/bin/bash   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EXPOSE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;端口&gt;//提供的端口服务   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;key&gt;=&lt;value&gt; ...//环境变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;src&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,... </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;dest&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//将文件从构建上下文（包括 URL）添加到镜像中。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;src&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,... </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;dest&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//从构建上下文中复制文件或目录到镜像中。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VOLUME</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/data&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]//创建一个可以从容器内部访问的挂载点。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;username&gt;[:&lt;group&gt;]//设置运行容器时的用户名或 UID，以及可选的用户组或 GID。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /path/to/workdir //为 RUN、CMD、ENTRYPOINT、COPY 和 ADD 设置工作目录。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ARG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;name&gt;[=&lt;default value&gt;] //定义构建时变量，这些变量在 Dockerfile 中可以被引用，但在构建后的镜像中不会存在。   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ONBUILD [INSTRUCTION]//为镜像添加触发器指令，当镜像被用作其他镜像的基础镜像时，这些触发器指令将会被执行。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">STOPSIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> signal //设置容器接收到的停止信号。   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HEALTHCHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --interval=5m --timeout=3s </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> curl -f http://localhost/ || exit 1   //配置健康检查指令   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SHELL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/bin/bash&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;-c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] //为 RUN、CMD 和 ENTRYPOINT 指令设置默认的 shell。   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">创建Dockerfile文件,然后执行 docker build -t &lt;镜像名&gt; .   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\`\`\`dockerfile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于 PHP 镜像  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> php:7.4-fpm-alpine  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置工作目录  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/www/html  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ... 其他指令 ...  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置一个环境变量，用于指定挂载点的路径（这个值将在运行时通过 docker run 命令设置）  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HOST_MOUNT_PATH=/path/to/host/data  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在 Dockerfile 中不能直接挂载，但可以在容器启动时通过 CMD 或 ENTRYPOINT 脚本使用此环境变量  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 例如，你可以编写一个启动脚本，在脚本中根据 HOST_MOUNT_PATH 来配置挂载  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 假设你有一个启动脚本 start.sh  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> start.sh /usr/local/bin/start.sh  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> chmod +x /usr/local/bin/start.sh  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用启动脚本作为容器的入口点  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;start.sh&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># EXPOSE 端口等其他指令...</span></span></code></pre></div><h2 id="network" tabindex="-1">network <a class="header-anchor" href="#network" aria-label="Permalink to &quot;network&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker network ls:列出   </span></span>
<span class="line"><span>docker network  inspect xxx:看网络详情</span></span></code></pre></div><h3 id="网络模式" tabindex="-1">网络模式 <a class="header-anchor" href="#网络模式" aria-label="Permalink to &quot;网络模式&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--network xxx   </span></span>
<span class="line"><span>bridge:为每一个容器分配、设置 IP 等，并将容器连接到一个 docker0</span></span>
<span class="line"><span>虚拟网桥，默认为该模式。   </span></span>
<span class="line"><span>host:容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP 和端口。   </span></span>
<span class="line"><span>none:容器有独立的 Network namespace，但并没有对其进行任何网络设置，如分配 veth pair 和网桥连接，IP 等。   </span></span>
<span class="line"><span>container:新创建的容器不会创建自己的网卡和配置自己的IP，而是和一个指定的容器共享IP，端口范围等      </span></span>
<span class="line"><span>自定义:</span></span></code></pre></div><h2 id="docker-compose" tabindex="-1">docker compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;docker compose&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker-compose -h                           # 查看帮助</span></span>
<span class="line"><span>docker-compose up                           # 启动所有docker-compose服务</span></span>
<span class="line"><span>docker-compose up -d                        # 启动所有docker-compose服务并后台运行</span></span>
<span class="line"><span>docker-compose down                         # 停止并删除容器、网络、卷、镜像。</span></span>
<span class="line"><span>docker-compose exec  yml里面的服务id                 # 进入容器实例内部  docker-compose exec docker-compose.yml文件中写的服务id /bin/bash</span></span>
<span class="line"><span>docker-compose ps                      # 展示当前docker-compose编排过的运行的所有容器</span></span>
<span class="line"><span>docker-compose top                     # 展示当前docker-compose编排过的容器进程</span></span>
<span class="line"><span></span></span>
<span class="line"><span>docker-compose logs  yml里面的服务id     # 查看容器输出日志</span></span>
<span class="line"><span>dokcer-compose config     # 检查配置</span></span>
<span class="line"><span>dokcer-compose config -q  # 检查配置，有问题才有输出</span></span>
<span class="line"><span>docker-compose restart   # 重启服务</span></span>
<span class="line"><span>docker-compose start     # 启动服务</span></span>
<span class="line"><span>docker-compose stop      # 停止服务</span></span></code></pre></div>`,26)])])}const E=a(p,[["render",t]]);export{c as __pageData,E as default};
